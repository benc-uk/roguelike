<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sprite Editor</title>
  <script type="module" src="main.js"></script>
  <link rel="shortcut icon" href="favicon.png" type="image/png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/siimple-icons/siimple-icons.css" />

</head>

<body x-data="app" x-effect="saveToStorage()">
  <template x-if="projectLoaded">
    <div>
      <div class="row" aria-label="Toolbar">
        <!-- <button @click="saveToStorage"><i class="si-disk fs24"></i> &nbsp; SAVE</button> -->
        <button @click="exportProject"><i class="si-file fs24"></i> &nbsp; EXPORT</button>
        <button @click="exportAllSprites"><i class="si-stack fs24"></i> &nbsp; GENERATE</button>
        <div style="width: 4rem"></div>
        <button @click="eraseProject"><i class="si-file-x fs24"></i> &nbsp; RESET</button>
      </div>

      <div class="row" aria-label="Main area" >
        <div x-data="editor(size)" class="padded" x-effect="drawSprite(); drawGrid();"
          @keyup.w.window="toolMoveUp"
          @keyup.s.window="toolMoveDown"
          @keyup.a.window="toolMoveLeft"
          @keyup.d.window="toolMoveRight">
          <div class="row align-center">
            <div class="grow">Editing:&nbsp;<input type="text" x-model="sprite.name" ></input></div>

            <button @click="toolFlipX"> <i class="si-arrow-alt-left fs24"></i></button>
            <button @click="toolFlipY"> <i class="si-arrow-alt-up fs24"></i></button>
            <button @click="toolColour"><i class="si-square-fill fs24"></i></button>
            <button @click="toolCopy">  <i class="si-copy fs24"></i></button>
            <button @click="toolPaste"> <i class="si-files fs24"></i></button>
            <button @click="toolClear"> <i class="si-trash fs24"></i></button>
          </div>
          <canvas width="600" height="600" x-ref="canvas" @click="handleClick" 
            
            @contextmenu.prevent="handleClick"
            @mousemove="handleClick">
          </canvas>
        </div>

        <div>
          <div class="padded">
            <h4>Colour Palette</h4>
            <div x-data="palette" class="pallete">
              <template x-for="(colour, index) in $store.pal.colours" :key="index">
                <input type="color" :value="colour" @change="editColour($event, index)"
                  @click="$store.pal.select(index)" @contextmenu="selectColour($event, index)"
                  :class="index == $store.pal.selected() ? 'selected' : ''" />
              </template>
            </div>
          </div>

          <div class="padded">
            <h4>Sprite Bank</h4>
            <div x-data="bank" class="bank" x-effect="updateSprite">
              <template x-for="(imgSrc, index) in spriteImages">
                <img :src="imgSrc" @click="$store.sprites.select(index)"
                  :class="index == $store.sprites.selectedIndex() ? 'selected' : ''"></img>
              </template>
            </div>
          </div>
        </div>
      </div>

      <div class="row" aria-label="Scratch area">
        <div>
          <h4>Test Map Area</h4>
          <div x-data="map()" class="padded scratch" x-ref="scratchGrid" x-effect="updateSprite(); updateStore()">
            <template x-for="(cell, index) in map">
              <img :src="cell.image" @click="clickCell($event, index)"
                @contextmenu.prevent="clickCell($event, index)" />
            </template>
          </div>
        </div>
      </div>
    </div>
  </template>

  <div x-show="!projectLoaded" class="dialog">
    <h1>NEW PROJECT</h1>

    Sprite Size
    <input type="number" x-model="newSpriteSize" placeholder="12" min="4" max="32" />

    Palette Size
    <input type="number" x-model="newPaletteSize" placeholder="12" min="4" max="32" />

    Bank Size
    <input type="number" x-model="newBankSize" placeholder="12" min="4" max="32" />

    <button @click="newProject()"><i class="si-file-check fs24"></i> &nbsp; CREATE</button>
    <button @click="importProject"><i class="si-disk fs24"></i> &nbsp; IMPORT</button>
  </div>

  <script type="module">
    // Import and initialize Alpine.js
    import Alpine from 'https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/module.esm.min.js'
    Alpine.start()
  </script>
</body>

</html>